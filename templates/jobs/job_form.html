{% extends 'base.html' %}

{% block title %}{{ page_title|default:"Job Form" }} - JoburiExpress{% endblock %}


{% block content %}
<div class="max-w-3xl mx-auto mt-10 mb-10 bg-white p-8 rounded-lg shadow-md border border-gray-200">
  <h1 class="text-2xl font-bold text-center text-gray-800 mb-8">{{ page_title|default:"Postează Job" }}</h1>

  <form method="post" class="space-y-6 needs-validation" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
        {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}

    {# Render fields manually #}
    <div>
        <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.title.label }}</label>
        {{ form.title }}
        {% if form.title.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.title.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="{{ form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.category.label }}</label>
            {{ form.category }}
            {% if form.category.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.category.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
        <div>
            <label for="{{ form.job_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.job_type.label }}</label>
            {{ form.job_type }}
            {% if form.job_type.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.job_type.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="{{ form.country.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.country.label }}</label>
            {{ form.country }}
            {% if form.country.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.country.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
         <div>
            <label for="{{ form.city.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.city.label }}</label>
            {{ form.city }}
            {% if form.city.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.city.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
    </div>

     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
         <div>
            <label for="{{ form.experience_level.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.experience_level.label }}</label>
            {{ form.experience_level }}
            {% if form.experience_level.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.experience_level.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
         <div>
            <label for="{{ form.positions_available.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.positions_available.label }}</label>
            {{ form.positions_available }}
            {% if form.positions_available.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.positions_available.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
            <label for="{{ form.salary_min.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.salary_min.label }}</label>
            {{ form.salary_min }}
            {% if form.salary_min.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.salary_min.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
         <div>
            <label for="{{ form.salary_max.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.salary_max.label }}</label>
            {{ form.salary_max }}
            {% if form.salary_max.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.salary_max.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
         <div>
            <label for="{{ form.salary_currency.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.salary_currency.label }}</label>
            {{ form.salary_currency }}
            {% if form.salary_currency.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.salary_currency.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
        </div>
    </div>

    {# New Description Fields #}
    <div>
        <label for="{{ form.ideal_candidate.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.ideal_candidate.label }}</label>
        {{ form.ideal_candidate }}
        {% if form.ideal_candidate.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.ideal_candidate.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
    </div>
     <div>
        <label for="{{ form.what_we_offer.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.what_we_offer.label }}</label>
        {{ form.what_we_offer }}
        {% if form.what_we_offer.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.what_we_offer.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
    </div>
     <div>
        <label for="{{ form.responsibilities.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{{ form.responsibilities.label }}</label>
        {{ form.responsibilities }}
        {% if form.responsibilities.errors %}<div class="mt-1 text-xs text-red-600">{% for error in form.responsibilities.errors %}<p>{{ error }}</p>{% endfor %}</div>{% endif %}
    </div>


    {# Submit Button #}
    <div class="pt-4">
        <button type="submit"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded transition duration-300">
          {% if object %}Actualizează Anunțul{% else %}Postează Anunțul{% endif %} {# Change button text if editing #}
        </button>
    </div>
  </form>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
(function () {
  'use strict';

  var forms = document.querySelectorAll('.needs-validation');

  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }

        form.classList.add('was-validated');

        Array.from(form.elements).forEach(function(element) {
            if (element.willValidate) {
                element.classList.remove('is-invalid', 'is-valid', 'border-red-500', 'border-green-500');
                const feedbackDiv = element.nextElementSibling;
                if (feedbackDiv && (feedbackDiv.classList.contains('invalid-feedback') || feedbackDiv.classList.contains('valid-feedback'))) {
                    feedbackDiv.innerHTML = '';
                }

                if (!element.checkValidity()) {
                    element.classList.add('is-invalid', 'border-red-500');
                    let invalidFeedback = element.nextElementSibling;
                    if (!invalidFeedback || !invalidFeedback.classList.contains('invalid-feedback')) {
                        invalidFeedback = document.createElement('div');
                        invalidFeedback.classList.add('invalid-feedback', 'mt-1', 'text-xs', 'text-red-600');
                        element.parentNode.insertBefore(invalidFeedback, element.nextSibling);
                    }
                    
                    // Custom Romanian validation messages
                    let message = '';
                    if (element.validity.valueMissing) {
                        message = 'Acest câmp este obligatoriu.';
                    } else if (element.validity.typeMismatch) {
                        if (element.type === 'email') {
                            message = 'Te rugăm să introduci o adresă de email validă.';
                        } else if (element.type === 'url') {
                            message = 'Te rugăm să introduci un URL valid.';
                        } else {
                            message = 'Te rugăm să introduci o valoare validă pentru acest tip de câmp.';
                        }
                    } else if (element.validity.patternMismatch) {
                        message = 'Te rugăm să respecți formatul solicitat.';
                        if(element.title) { // Use title attribute if available for more specific pattern message
                            message = element.title;
                        }
                    } else if (element.validity.tooShort) {
                        message = `Te rugăm să introduci cel puțin ${element.minLength} caractere. Ai introdus ${element.value.length}.`;
                    } else if (element.validity.tooLong) {
                        message = `Te rugăm să nu introduci mai mult de ${element.maxLength} caractere. Ai introdus ${element.value.length}.`;
                    } else if (element.validity.rangeUnderflow) {
                        message = `Valoarea trebuie să fie mai mare sau egală cu ${element.min}.`;
                    } else if (element.validity.rangeOverflow) {
                        message = `Valoarea trebuie să fie mai mică sau egală cu ${element.max}.`;
                    } else {
                        message = element.validationMessage; // Fallback to browser's default if not covered, though ideally we cover all.
                    }
                    invalidFeedback.innerHTML = message;

                } else {
                    element.classList.add('is-valid', 'border-green-500');
                    // Remove default valid message or make it optional
                    // let validFeedback = element.nextElementSibling;
                    // if (!validFeedback || !validFeedback.classList.contains('valid-feedback')) {
                    //     validFeedback = document.createElement('div');
                    //     validFeedback.classList.add('valid-feedback', 'mt-1', 'text-xs', 'text-green-600');
                    //     element.parentNode.insertBefore(validFeedback, element.nextSibling);
                    // }
                    // validFeedback.innerHTML = ''; // No message for valid fields, or 'Arată bine!' if preferred
                }
            }
        });

      }, false);
    });
})();
</script>
{% endblock %}
